<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>AIè²¸è¶…äºº</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@700&family=Roboto+Slab:wght@700&display=swap" rel="stylesheet">
    <style>
        body { 
            font-family: Arial, sans-serif; 
            background-color: #ffffff; /* ç™½è‰²èƒŒæ™¯ */
            margin: 0; 
            padding: 20px; 
        }
        .container { 
            display: flex; 
            max-width: 1200px; 
            margin: auto; 
            gap: 20px; 
        }
        .input-section, .result-section { 
            flex: 1; 
            padding: 20px; 
            background: #e8f5e9; /* æ·ºç¶ èƒŒæ™¯ */
            border-radius: 8px; 
            box-shadow: 0 0 10px rgba(0,0,0,0.1); 
            border: 1px solid #d4af37; /* é‡‘è‰²é‚Šæ¡† */
            box-sizing: border-box;
        }
        label { 
            display: block; 
            margin: 10px 0; 
            font-weight: bold; 
            color: #1b5e20; /* æ·±ç¶ æ–‡å­— */
        }
        input[type="number"], input[type="text"] { 
            width: 100%; 
            padding: 8px; 
            margin-bottom: 10px; 
            border: 1px solid #d4af37; /* é‡‘è‰²é‚Šæ¡† */
            border-radius: 4px; 
            box-sizing: border-box; 
        }
        button { 
            padding: 10px 20px; 
            background-color: #2e7d32; /* æ·±ç¶ æŒ‰éˆ• */
            color: white; 
            border: none; 
            border-radius: 4px; 
            cursor: pointer; 
        }
        button:hover { 
            background-color: #1b5e20; /* ç¨æš—çš„æ·±ç¶ æ‡¸åœ */
        }
        h1 { 
            font-family: 'Noto Serif TC', serif; /* å„ªåŒ–å­—å‹ */
            font-weight: 700; 
            font-size: 2.5em; 
            color: #8b0000; /* é…’ç´…æ¨™é¡Œ */
            text-align: center; 
            margin-bottom: 10px; 
            border-bottom: 2px solid #d4af37; /* é‡‘è‰²é‚Šæ¡† */
        }
        h2, h3 { 
            color: #1b5e20; /* æ·±ç¶ å…¶ä»–æ¨™é¡Œ */
            text-align: center; 
        }
        h2 { 
            margin-bottom: 20px; 
        }
        h3 { 
            margin-bottom: 15px; 
        }
        #result p { 
            color: #1b5e20; /* æ·±ç¶ æ–‡å­— */
        }
    </style>
</head>
<body>
    <h1>AIè²¸è¶…äºº</h1>
    <h2>åœŸåœ°å…¬è¶…äººå®ˆè­·æ‚¨çš„è³¼å±‹å¤¢æƒ³ï¼</h2>

    <div class="container">
        <div class="input-section">
            <h3>åœŸåœ°å…¬ç¥ç®—è¼¸å…¥</h3>
            <form>
                <label for="address">æˆäº¤ç‰©ä»¶åœ°å€ï¼š</label>
                <input type="text" id="address">

                <label><input type="checkbox" id="is_taipei"> ä½æ–¼å°åŒ—å¸‚</label>
                <label><input type="checkbox" id="is_new_taipei_mrt"> ä½æ–¼æ–°åŒ—å¸‚ä½†è·é›¢æ·é‹ç«™ä¸€åƒå…¬å°ºä»¥å…§</label>
                <label><input type="checkbox" id="is_tsb_batch"> æˆäº¤ç‰©ä»¶ç‚ºåœŸéŠ€åˆ†æˆ¶è²¸æ¬¾</label>

                <label for="credit_balance">å·²æœ‰ä¿¡ç”¨è²¸æ¬¾é¤˜é¡ï¼ˆå…ƒï¼‰ï¼š</label>
                <input type="number" id="credit_balance" value="0" min="0">

                <label for="house_loan_balance">å·²æœ‰æˆ¿å±‹è²¸æ¬¾é¤˜é¡ï¼ˆå…ƒï¼‰ï¼š</label>
                <input type="number" id="house_loan_balance" value="0" min="0">

                <label><input type="checkbox" id="has_house_12ping"> å·²æœ‰æˆ¿å±‹ä¸”æ‰€æŒæŒä»½é”12åª</label>
                <label><input type="checkbox" id="has_2_plus"> å·²æœ‰2æˆ¶å«ä»¥ä¸Šè³¼å±‹æˆ¿è²¸</label>
                <label><input type="checkbox" id="is_change_house"> ç‚ºæ›å±‹</label>

                <label for="annual_income">ç¸½å¹´æ”¶å…¥é‡‘é¡ï¼ˆå…ƒï¼‰ï¼š</label>
                <input type="number" id="annual_income" min="0">

                <label><input type="checkbox" id="has_tax_record"> æ‰€å¡«ç¸½å¹´æ”¶å‡æœ‰æœ€æ–°å ±ç¨…ç´€éŒ„</label>

                <label for="transaction_price">æˆäº¤åƒ¹ï¼ˆå…ƒï¼‰ï¼š</label>
                <input type="number" id="transaction_price" min="0">

                <label><input type="checkbox" id="is_reasonable_price"> ç¢ºèªç¢ºç‚ºè©²å€åŸŸåˆç†åƒ¹</label>
                <label><input type="checkbox" id="is_self_use"> ç‚ºè‡ªä½ä½¿ç”¨</label>

                <label for="area_ping">ä¸å«è»Šä½ç™»è¨˜é¢ç©ï¼ˆåªï¼‰ï¼š</label>
                <input type="number" id="area_ping" min="0">

                <button type="button" onclick="calculate()">ğŸŒ¾ åœŸåœ°å…¬ç¥ç®—</button>
            </form>
        </div>

        <div class="result-section">
            <h3>ç¥ç®—çµæœ</h3>
            <div id="result">
                <p>è«‹å¡«å¯«å·¦å´è³‡æ–™ï¼Œè®“åœŸåœ°å…¬è¶…äººç‚ºæ‚¨ç¥ç®—æœ€ä½³æˆ¿è²¸æ–¹æ¡ˆï¼</p>
                <p>â›©ï¸</p>
            </div>
        </div>
    </div>

    <script>
        function calculate() {
            // ç²å–è¼¸å…¥å€¼
            const address = document.getElementById('address').value;
            const is_taipei = document.getElementById('is_taipei').checked;
            const is_new_taipei_mrt = document.getElementById('is_new_taipei_mrt').checked;
            const is_tsb_batch = document.getElementById('is_tsb_batch').checked;
            const credit_balance = parseFloat(document.getElementById('credit_balance').value) || 0;
            let house_loan_balance = parseFloat(document.getElementById('house_loan_balance').value) || 0;
            let has_house_12ping = document.getElementById('has_house_12ping').checked;
            let has_2_plus = document.getElementById('has_2_plus').checked;
            const is_change_house = document.getElementById('is_change_house').checked;
            const annual_income = parseFloat(document.getElementById('annual_income').value) || 0;
            const has_tax_record = document.getElementById('has_tax_record').checked;
            const transaction_price = parseFloat(document.getElementById('transaction_price').value) || 0;
            const is_reasonable_price = document.getElementById('is_reasonable_price').checked;
            const is_self_use = document.getElementById('is_self_use').checked;
            const area_ping = parseFloat(document.getElementById('area_ping').value) || 0;

            if (annual_income <= 0 || transaction_price <= 0) {
                document.getElementById('result').innerHTML = 'è«‹è¼¸å…¥æœ‰æ•ˆçš„ç¸½å¹´æ”¶å…¥å’Œæˆäº¤åƒ¹ã€‚';
                return;
            }

            // è‹¥å‹¾é¸ç‚ºæ›å±‹ï¼Œæˆ¿å±‹è²¸æ¬¾é¤˜é¡é‡ç½®ç‚ºé›¶ï¼Œä¸”è¦–ç‚ºç„¡å‹¾é¸ã€Œå·²æœ‰æˆ¿å±‹ä¸”æ‰€æŒæŒä»½é”12åªã€åŠã€Œå·²æœ‰2æˆ¶å«ä»¥ä¸Šè³¼å±‹æˆ¿è²¸ã€
            if (is_change_house) {
                house_loan_balance = 0;
                has_house_12ping = false;
                has_2_plus = false;
            }

            const special_address = is_taipei || is_new_taipei_mrt;
            const existing_debt = credit_balance + house_loan_balance;

            // è¨ˆç®—å‡è¨­ LTV=0.8 ä¸‹çš„è² å‚µæ¯”
            const assume_loan = transaction_price * 0.8;
            const assume_total_debt = existing_debt + assume_loan;
            const assume_debt_ratio = assume_total_debt / annual_income;

            let ltv;
            let initial_ltv; // ç”¨æ–¼æª¢æŸ¥æ˜¯å¦å–®ç´”å› æ¢ä»¶ä¸€å°è‡´æˆæ•¸é™ä½
            if (special_address) {
                ltv = 0.8;
            } else if (annual_income > 1200000 && assume_debt_ratio <= 12) {
                ltv = 0.8;
            } else if (annual_income > 600000 && assume_debt_ratio <= 8) {
                ltv = 0.8;
            } else {
                ltv = 0.75;
            }
            initial_ltv = ltv; // å„²å­˜åˆå§‹æˆæ•¸

            // æ‡‰ç”¨æœ€é«˜é™åˆ¶
            let warnings = [
                'è©¦ç®—åƒ…ä¾›åƒè€ƒ(å°¤ä»¥å¾µä¿¡å¯ç”¨æ”¶å…¥ä»éœ€å¦è©•ä¼°ä¾‹å¦‚è‚²å…’ã€ä¿¡ç”¨å¡åˆ†æœŸç­‰ç­‰æ”¯å‡º)',
                'è«‹å‹™å¿…ç¢ºèªç¢ºç‚ºè©²å€åŸŸåˆç†åƒ¹'
            ];
            // æ¢ä»¶å…­ï¼šæˆ¿å±‹è²¸æ¬¾é¤˜é¡ä¸ç‚ºé›¶ æˆ– å·²æœ‰æˆ¿å±‹ä¸”æ‰€æŒæŒä»½é”12åªï¼Œæœ€é«˜ä¸ƒæˆ
            if (house_loan_balance > 0 || has_house_12ping) {
                ltv = Math.min(ltv, 0.7);
            }
            // æ¢ä»¶ä¸ƒï¼šå·²æœ‰2æˆ¶ä»¥ä¸Šè³¼å±‹æˆ¿è²¸ï¼Œæœ€é«˜ä¸‰æˆ
            if (has_2_plus) {
                ltv = Math.min(ltv, 0.3);
                warnings.push('å¤®è¡Œç®¡æ§ç¬¬3æˆ¶');
            }
            // æ¢ä»¶å…«ï¼šæˆ¿å±‹è²¸æ¬¾é¤˜é¡ä¸ç‚ºé›¶ ä¸” æœªå‹¾é¸ç‚ºæ›å±‹ï¼Œæœ€é«˜äº”æˆ
            if (house_loan_balance > 0 && !is_change_house) {
                ltv = Math.min(ltv, 0.5);
                warnings.push('å¤®è¡Œç®¡æ§ç¬¬2æˆ¶');
            }
            // æ¢ä»¶ä¹ï¼šå·²æœ‰æˆ¿å±‹ä¸”æ‰€æŒæŒä»½é”12åª ä¸” æœªå‹¾é¸æ›å±‹ ä¸” æˆ¿å±‹è²¸æ¬¾é¤˜é¡ç‚ºé›¶ï¼Œæœ€é«˜ä¸ƒæˆ
            if (has_house_12ping && !is_change_house && house_loan_balance === 0) {
                ltv = Math.min(ltv, 0.7);
            }

            // å¹´é‡‘æ”¯ä»˜å‡½æ•¸ (å¹´åº¦æ”¯ä»˜)
            function annual_payment(amount, years, rate) {
                if (amount === 0 || years === 0) return 0;
                const r = rate;
                const n = years;
                return amount * (r * Math.pow(1 + r, n)) / (Math.pow(1 + r, n) - 1);
            }

            // è¨ˆç®—æ—¢æœ‰è²¸æ¬¾å¹´åº¦å„Ÿé‚„é¡
            const credit_annual = annual_payment(credit_balance, 7, 0.03);
            const house_annual = annual_payment(house_loan_balance, 30, 0.03);
            const available = annual_income - 250000 - credit_annual - house_annual;

            // èª¿æ•´ LTV ä»¥æ»¿è¶³å„Ÿé‚„æ¢ä»¶
            let loan_amount = transaction_price * ltv;
            let loan_annual = annual_payment(loan_amount, 30, 0.03);
            let adjusted_due_to_condition_1 = false;
            if (loan_annual > available) {
                adjusted_due_to_condition_1 = true;
                while (loan_annual > available && ltv > 0) {
                    ltv -= 0.005; // æ¯æ¬¡é™ä½ 0.5%
                    loan_amount = transaction_price * ltv;
                    loan_annual = annual_payment(loan_amount, 30, 0.03);
                }
            }

            // æœ€çµ‚è¨ˆç®—
            const total_debt = existing_debt + loan_amount;
            const debt_ratio = total_debt / annual_income;

            // å…¶ä»–è­¦èª
            if (!is_self_use) {
                warnings.push('è«‹å‹™å¿…è©¢å•è¡Œå“¡éè‡ªä½ä½¿ç”¨å¯å¦è²¸æ¬¾');
            }
            if (area_ping < 15) {
                warnings.push('è«‹è©¢å•è¡Œå“¡å¥—æˆ¿è¦å®š');
            }
            if (transaction_price > 49000000) {
                warnings.push('è«‹è©¢å•è¡Œå“¡é«˜åƒ¹ä½å®…è¦å®š');
            }
            if (is_tsb_batch) {
                warnings.push('è«‹å‘ŠçŸ¥è¡Œå“¡ç‚ºæ•´æ‰¹åˆ†æˆ¶æˆ¿è²¸');
            }
            if (is_change_house) {
                warnings.push('å¾ŒçºŒè«‹ä¾è¦å”è™•èˆŠæ›æ–°');
            }
            const margin = available - loan_annual;
            if (margin > 0 && margin / available < 0.05) { // å°‘æ–¼5% é¤˜è£•
                warnings.push('é¤˜çµ€ç·Šç¹ƒè‹¥æœªå¢ææœ‰é¤˜çµ€ä¿äººå°‡å°è‡´æˆæ•¸å¯èƒ½å­˜åœ¨èª¤å·®3%~5%');
            }
            if (adjusted_due_to_condition_1) {
                warnings.push('è‹¥æˆæ•¸ä¸ç¬¦æ‚¨é æœŸ å»ºè­°å¢ææœ‰é¤˜çµ€ä¹‹ä¿è­‰äººå¯æ”¹å–„');
            }
            if (!has_tax_record) {
                warnings.push('å¹´æ”¶ç„¡å ±ç¨…è³‡æ–™è«‹å‹™å¿…å…ˆè¡Œæä¾›å¦‚è¿‘ä¸€å¹´æ”¶å…¥äº¤æ˜“æ˜ç´°æˆ–æ‰€ç‡Ÿäº‹æ¥­401è¡¨è©¢å•è¡Œå“¡');
            }

            // è¼¸å‡ºçµæœ
            let output = `
                <p><strong>æˆ¿è²¸æˆæ•¸ï¼š</strong> ${(ltv * 100).toFixed(2)}%</p>
                <p><strong>è²¸æ¬¾é‡‘é¡ï¼š</strong> ${loan_amount.toFixed(0)}</p>
                <p><strong>è² å‚µæ¯”ï¼š</strong> ${debt_ratio.toFixed(2)}</p>
                <p><strong>ç²—ä¼°æ¯å¹´æˆ¿è²¸å„Ÿé‚„é¡ï¼ˆæœ¬æ¯ï¼Œåˆ©æ¯ä»¥3%è¨ˆç®—ï¼‰ï¼š</strong> ${loan_annual.toFixed(0)}</p>
                <p><strong>ç²—ä¼°å¾µä¿¡å¯ç”¨æ”¶å…¥ï¼ˆæ‰£é™¤æ—¢æœ‰å„Ÿé‚„åŠ25è¬å¾Œï¼‰ï¼š</strong> ${available.toFixed(0)}</p>
                <p><strong>åˆ©ç‡ï¼š</strong> ä¸€ã€æ–°é’å®‰è²¸æ¬¾åˆ©ç‡è£œè²¼æœŸéå¾Œï¼š2.275%èµ· äºŒã€å…¬æ•™2.31%èµ· ä¸‰ã€åœŸéŠ€åˆ†æˆ¶è²¸æ¬¾é¦–è³¼2.475%~2.805% å››ã€å…¶é¤˜é¦–è³¼3.25%èµ· ã€‚ è«‹è«®è©¢è¡Œå“¡æ‰€é©ç”¨åˆ©ç‡</p>
                <p><strong>è²¸æ¬¾å¹´é™ï¼š</strong> ä¸€ã€æ–°é’å®‰è²¸æ¬¾æœ€é•·40å¹´ äºŒã€å…¶é¤˜20~30å¹´ ã€‚ è«‹æä¾›å¹´é½¡è³‡è¨Šè«®è©¢è¡Œå“¡</p>
                <p><strong>å¯¬é™æœŸï¼š</strong> ä¸€ã€æ–°é’å®‰è²¸æ¬¾æœ€é•·5å¹´ äºŒã€å…¶é¤˜0~3å¹´ ã€‚ è‹¥æœ‰éœ€æ±‚è«‹è©¢å•è¡Œå“¡å¯¬é™æœŸè¦å®š</p>
            `;
            if (warnings.length > 0) {
                output += `<p><strong>è­¦èªï¼š</strong><br>${warnings.join('<br>')}</p>`;
            }

            document.getElementById('result').innerHTML = output;
        }
    </script>
</body>
</html>